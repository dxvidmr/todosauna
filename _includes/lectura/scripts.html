<!-- ============================================
     SCRIPTS SALA DE LECTURA
     Orden de carga CRÍTICO - NO modificar
     ============================================ -->

<!-- 1. Configuración (credenciales Supabase) -->
<script src="{{ '/assets/js/lectura/config.js' | relative_url }}"></script>

<!-- 2. Cliente Supabase (usa config.js) -->
<script src="{{ '/assets/js/lectura/supabase-client.js' | relative_url }}"></script>

<!-- 3. Utilidades generales -->
<script src="{{ '/assets/js/lectura/utils.js' | relative_url }}"></script>

<!-- 4. Gestión de usuario -->
<script src="{{ '/assets/js/lectura/user-manager.js' | relative_url }}"></script>

<!-- 5. Modal de modo de participación -->
<script src="{{ '/assets/js/lectura/modal-modo.js' | relative_url }}"></script>

<!-- 6. Gestión de notas (carga desde Supabase) -->
<script src="{{ '/assets/js/lectura/notas.js' | relative_url }}"></script>

<!-- 7. Estadísticas de evaluaciones (módulo reutilizable) -->
<script src="{{ '/assets/js/lectura/evaluaciones-stats.js' | relative_url }}"></script>

<!-- 8. CETEIcean (versión custom) -->
<script src="{{ '/assets/js/lectura/CETEI.js' | relative_url }}"></script>

<!-- 9. Cargar XMLs -->
<script>
    // Variable global para almacenar las notas XML
    window.notasXML = null;

    // Cargar el archivo de notas externas
    fetch('{{ "/assets/data/tei/notas.xml" | relative_url }}')
        .then(response => response.text())
        .then(str => {
            const parser = new DOMParser();
            window.notasXML = parser.parseFromString(str, "application/xml");
            console.log('✓ Notas XML cargadas:', window.notasXML);
        })
        .catch(error => console.error('Error cargando notas.xml:', error));

    // Cargar el documento TEI principal
    var CETEIcean = new CETEI();
    CETEIcean.getHTML5('{{ "/assets/data/tei/fuenteovejuna.xml" | relative_url }}', function(data) {
        document.getElementById("TEI").appendChild(data);
        console.log('TEI principal cargado');
    });
</script>

<!-- 10. Utilidades de renderización compartidas -->
<script src="{{ '/assets/js/lectura/rendering-utils.js' | relative_url }}"></script>

<!-- 11. Lógica de edición (procesa notas, eventos, etc.) -->
<script src="{{ '/assets/js/lectura/sala-de-lectura.js' | relative_url }}"></script>

<!-- 12. Sistema de evaluación (añade iconos: útil / mejorable) -->
<script src="{{ '/assets/js/lectura/sala-de-lectura-evaluacion.js' | relative_url }}"></script>

<!-- 13. Sistema de sugerencias de notas faltantes -->
<script src="{{ '/assets/js/lectura/sugerencias-notas.js' | relative_url }}"></script>
