<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Laboratorio de notas - Fuenteovejuna</title>
  
  <!-- CSS -->
  <link rel="stylesheet" href="../assets/css/main.css">
  <link rel="stylesheet" href="../assets/css/components.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../assets/css/sala-de-lectura.css">
  <link rel="stylesheet" href="../assets/css/laboratorio-de-notas.css">
  
  <!-- Librerías externas -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.js"></script>
</head>
<body>
  
  <!-- Navegación -->
  <nav class="top-nav" role="navigation" aria-label="Navegación principal">
    <a href="../index.html" class="nav-back"><i class="fa-solid fa-arrow-left" aria-hidden="true"></i> Inicio</a>
    <a href="../sala-de-lectura/index.html">Sala de lectura</a>
    <button id="btn-modo-usuario" class="btn-modo-usuario"><i class="fa-solid fa-user" aria-hidden="true"></i> Mi participación</button>
  </nav>
  
  <!-- Pantalla de bienvenida -->
  <div id="laboratorio-bienvenida" class="laboratorio-bienvenida">
    <div class="bienvenida-container">
      <h1 class="bienvenida-titulo"><i class="fa-solid fa-flask" aria-hidden="true"></i> Laboratorio de notas</h1>
      
      <!-- Lado izquierdo: Explicación -->
      <div class="bienvenida-explicacion">
        <div class="explicacion-seccion">
          <h3>¿Qué es?</h3>
          <p>Un espacio colaborativo donde puedes leer pasajes de <em>Fuenteovejuna</em> y evaluar si las notas explicativas te resultan útiles para entender la obra.</p>
        </div>
        
        <div class="explicacion-seccion">
          <h3>¿Para qué?</h3>
          <p>Tu opinión ayuda a mejorar la experiencia de lectura para toda la comunidad. Con tus evaluaciones contribuyes a identificar qué notas funcionan mejor o dónde faltan.</p>
        </div>
        
        <div class="explicacion-seccion">
          <h3>¿Cómo funciona?</h3>
          <ol>
            <li>Elige un modo de juego (secuencial o aleatorio)</li>
            <li>Lee el pasaje y haz clic en el texto subrayado para ver las notas</li>
            <li>Evalúa cada nota como "útil" o "mejorable"</li>
            <li>También puedes seleccionar cualquier fragmento del texto y sugerir nuevas notas</li>
            <li>Continúa con el siguiente pasaje</li>
          </ol>
        </div>
      </div>
      
      <!-- Lado derecho: Opciones de entrada -->
      <div class="bienvenida-opciones">
        <div class="opcion-modo">
          <div class="opcion-icono"></div>
          <h3>Modo secuencial</h3>
          <p>Recorre los pasajes en orden cronológico de la obra</p>
          <button id="btn-modo-secuencial" class="btn-modo-entrada">
            <i class="fa-solid fa-list-ol" aria-hidden="true"></i> Comenzar en orden
          </button>
        </div>
        
        <div class="opcion-modo">
          <div class="opcion-icono"></div>
          <h3>Modo aleatorio</h3>
          <p>Sorpréndete con un pasaje al azar de la obra</p>
          <button id="btn-modo-aleatorio" class="btn-modo-entrada">
            <i class="fa-solid fa-shuffle" aria-hidden="true"></i> Sorpréndeme
          </button>
        </div>
        
        <div class="stats-globales">
          <div class="loading-stats-container">
            <i class="fa-solid fa-spinner fa-spin" aria-hidden="true"></i>
            Cargando estadísticas...
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Contenido principal: Layout de dos columnas -->
  <div class="laboratorio-layout">
    
    <!-- Columna izquierda: Texto del pasaje -->
    <div class="laboratorio-text-column">
      
      <!-- Header del editor social -->
      <div class="laboratorio-header">
        <h1>Laboratorio de notas</h1>
        <p>Lee los pasajes y evalúa si las notas te resultan útiles</p>
        
        <!-- Barra de progreso (solo modo secuencial) -->
        <div id="barra-progreso-container" class="barra-progreso-container" style="display: none;">
          <div class="barra-progreso">
            <div id="barra-progreso-fill" class="barra-progreso-fill" style="width: 0%"></div>
          </div>
        </div>
        
        <div class="laboratorio-progreso">
          Pasaje <span id="pasaje-actual">1</span> de <span id="pasajes-totales">-</span>
          <span id="modo-actual-badge" class="modo-badge"></span>
        </div>
      </div>
      
      <!-- Pasaje actual -->
      <div class="pasaje-container">
        <div id="pasaje-content">
          <div class="loading">Cargando pasaje...</div>
        </div>
      </div>
      
      <!-- Controles de navegación de pasajes -->
      <div class="laboratorio-controles">
        <button id="btn-anterior" class="btn-navegacion" style="display: none;"><i class="fa-solid fa-arrow-left" aria-hidden="true"></i> Pasaje anterior</button>
        <button id="btn-siguiente" class="btn-siguiente">Siguiente pasaje <i class="fa-solid fa-arrow-right" aria-hidden="true"></i></button>
        <button id="btn-saltar" class="btn-saltar">Saltar sin evaluar</button>
        <button id="btn-cambiar-modo" class="btn-cambiar-modo" title="Volver a la pantalla de selección de modo">
          <i class="fa-solid fa-home" aria-hidden="true"></i> Cambiar modo
        </button>
      </div>
      
    </div>
    
    <!-- Columna derecha: Panel de notas -->
    <div class="laboratorio-notes-column">
      
      <!-- Header del panel de notas -->
      <div class="notas-panel-header">
        <h3>Notas</h3>
        <div class="notas-contador">
          <span id="notas-evaluadas">0</span> de <span id="notas-totales">0</span> evaluadas
        </div>
      </div>
      
      <!-- Navegación entre notas -->
      <div class="notas-navegacion">
        <button id="btn-nota-anterior" class="btn-nav-nota" title="Nota anterior">
          <i class="fa-solid fa-chevron-left" aria-hidden="true"></i>
        </button>
        <span class="nota-posicion">
          Nota <span id="nota-actual-index">0</span> de <span id="notas-pasaje-total">0</span>
        </span>
        <button id="btn-nota-siguiente" class="btn-nav-nota" title="Nota siguiente">
          <i class="fa-solid fa-chevron-right" aria-hidden="true"></i>
        </button>
      </div>
      
      <!-- Contenido de la nota actual -->
      <div id="nota-content" class="nota-content">
        <p class="placeholder-text">Haz clic en un texto subrayado o usa las flechas para ver las notas</p>
      </div>
      
      <!-- Instrucciones -->
      <div class="notas-instrucciones">
        <p><i class="fa-solid fa-info-circle" aria-hidden="true"></i> Haz clic en el texto subrayado para ver cada nota, o navega con las flechas.</p>
      </div>
      
    </div>
    
  </div>
  
  <!-- Modal de modo (se carga dinámicamente) -->
  <div id="modal-container"></div>
  
  <!-- Scripts -->
  <script src="../assets/js/CETEI.js"></script>
  <script src="../assets/js/config.js"></script>
  <script src="../assets/js/supabase-client.js"></script>
  <script src="../assets/js/utils.js"></script>
  <script src="../assets/js/user-manager.js"></script>
  <script src="../assets/js/modal-modo.js"></script>
  <script src="../assets/js/pasajes.js"></script>
  <script src="../assets/js/notas.js"></script>
  <script src="../assets/js/evaluaciones-stats.js"></script>
  <script src="../assets/js/rendering-utils.js"></script>
  <script src="../assets/js/laboratorio-de-notas.js"></script>
  
  <!-- Sistema de sugerencias de notas faltantes -->
  <script src="../assets/js/sugerencias-notas.js"></script>
  
</body>
</html>
